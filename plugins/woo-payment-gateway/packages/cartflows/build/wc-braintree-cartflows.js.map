{"version":3,"sources":["webpack://wcBraintree.[name]/./node_modules/@babel/runtime/helpers/asyncToGenerator.js","webpack://wcBraintree.[name]/./node_modules/@babel/runtime/helpers/defineProperty.js","webpack://wcBraintree.[name]/./node_modules/@babel/runtime/helpers/interopRequireDefault.js","webpack://wcBraintree.[name]/external \"jQuery\"","webpack://wcBraintree.[name]/external \"regeneratorRuntime\"","webpack://wcBraintree.[name]/external [\"braintree\",\"client\"]","webpack://wcBraintree.[name]/external [\"braintree\",\"threeDSecure\"]","webpack://wcBraintree.[name]/webpack/bootstrap","webpack://wcBraintree.[name]/./packages/cartflows/assets/js/cartflows.js"],"names":["asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","module","exports","fn","self","this","args","arguments","apply","err","undefined","obj","Object","defineProperty","enumerable","configurable","writable","__esModule","window","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","currentButton","wcBraintreeData","cartflows_offer","wcBraintree","client","braintreeClient","create","authorization","clientToken","clientInstance","console","log","_3dSecure","threeDSecure","version","instance","handleHashChange","e","match","newURL","JSON","parse","atob","decodeURIComponent","nonce","history","pushState","location","pathname","search","verifyCard","amount","bin","details","order","threeDSData","onLookupComplete","data","next","payload","displayMessage","message","liabilityShifted","storeVaultedNonce","order_id","step_id","click","threeDSFailedMsg","$","ajax","url","ajax_url","method","dataType","security","result","success","fail","msg","trigger","setTimeout","document","body","successMessage","timeout","addEventListener","on","currentTarget"],"mappings":"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","file":"wc-braintree-cartflows.js","sourcesContent":["function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nmodule.exports = _asyncToGenerator;","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","function _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nmodule.exports = _interopRequireDefault;","module.exports = window[\"jQuery\"];","module.exports = window[\"regeneratorRuntime\"];","module.exports = window[\"braintree\"][\"client\"];","module.exports = window[\"braintree\"][\"threeDSecure\"];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import braintreeClient from '@braintree/client';\r\nimport threeDSecure from '@braintree/three-d-secure';\r\nimport $ from 'jquery';\r\n\r\nconst wcBraintreeData = cartflows_offer.wcBraintree;\r\n\r\nconst client = new Promise((resolve, reject) => {\r\n    braintreeClient.create({\r\n        authorization: wcBraintreeData.clientToken\r\n    }, (err, clientInstance) => {\r\n        if (err) {\r\n            console.log(err);\r\n            reject()\r\n        } else {\r\n            resolve(clientInstance);\r\n        }\r\n    })\r\n});\r\n\r\nconst _3dSecure = new Promise(async (resolve, reject) => {\r\n    const clientInstance = await client;\r\n    threeDSecure.create({\r\n        version: 2,\r\n        client: clientInstance\r\n    }, (err, instance) => {\r\n        if (err) {\r\n            return reject(err);\r\n        }\r\n        return resolve(instance);\r\n    });\r\n})\r\n\r\nlet currentButton;\r\n\r\nconst initialize = () => {\r\n    window.addEventListener('hashchange', handleHashChange);\r\n    $(document.body).on('click', 'a[href*=\"wcf-up-offer\"], a[href*=\"wcf-down-offer\"]', handleButtonClick);\r\n}\r\n\r\nconst handleButtonClick = (e) => {\r\n    currentButton = $(e.currentTarget);\r\n}\r\n\r\nconst handleHashChange = async (e) => {\r\n    var match = e.newURL.match(/wcBraintree3DS=(.*)/);\r\n    if (match) {\r\n        try {\r\n            var obj = JSON.parse(window.atob(decodeURIComponent(match[1])));\r\n            if (obj.nonce) {\r\n                history.pushState({}, '', window.location.pathname + window.location.search);\r\n                // process the vaulted nonce\r\n                _3dSecure.then(instance => {\r\n                    instance.verifyCard({\r\n                        amount: obj.amount,\r\n                        nonce: obj.nonce,\r\n                        bin: obj.details.bin,\r\n                        ...wcBraintreeData?.order?.threeDSData,\r\n                        onLookupComplete: (data, next) => next(),\r\n                    }, async (err, payload) => {\r\n                        if (err) {\r\n                            displayMessage(err.message);\r\n                        } else {\r\n                            if (payload.liabilityShifted) {\r\n                                // save the nonce to the order\r\n                                await storeVaultedNonce({\r\n                                    nonce: payload.nonce,\r\n                                    order_id: cartflows_offer.order_id,\r\n                                    step_id: cartflows_offer.step_id\r\n                                });\r\n                                // nonce saved, trigger click\r\n                                currentButton.click();\r\n                            } else {\r\n                                displayMessage(wcBraintreeData.threeDSFailedMsg);\r\n                            }\r\n                        }\r\n                    });\r\n                })\r\n            } else if (obj.error) {\r\n                displayMessage(obj.message);\r\n            }\r\n        } catch (err) {\r\n\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nconst storeVaultedNonce = ({nonce, order_id, step_id}) => {\r\n    return new Promise((resolve, reject) => {\r\n        $.ajax({\r\n            url: wcBraintreeData?.ajax_url,\r\n            method: 'POST',\r\n            dataType: 'json',\r\n            data: {nonce, order_id, step_id, security: wcBraintreeData?.security?.storeVaultedNonce}\r\n        }).done(result => {\r\n            if (result.success) {\r\n                resolve();\r\n            } else {\r\n                // display error\r\n            }\r\n        }).fail(() => {\r\n            reject();\r\n        })\r\n    })\r\n}\r\n\r\nconst displayMessage = (msg) => {\r\n    $('body').trigger('wcf-update-msg', [msg, 'wcf-payment-error']);\r\n    setTimeout(() => {\r\n        $(document.body).trigger('wcf-hide-loader');\r\n        $(document.body).trigger('wcf-update-msg', [wcBraintreeData.successMessage, 'wcf-payment-success']);\r\n    }, wcBraintreeData.timeout);\r\n}\r\n\r\ninitialize();"],"sourceRoot":""}