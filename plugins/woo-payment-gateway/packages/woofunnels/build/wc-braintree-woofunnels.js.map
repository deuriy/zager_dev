{"version":3,"sources":["webpack://wcBraintree.[name]/./node_modules/@babel/runtime/helpers/defineProperty.js","webpack://wcBraintree.[name]/./node_modules/@babel/runtime/helpers/interopRequireDefault.js","webpack://wcBraintree.[name]/external \"jQuery\"","webpack://wcBraintree.[name]/external [\"braintree\",\"dataCollector\"]","webpack://wcBraintree.[name]/external [\"braintree\",\"threeDSecure\"]","webpack://wcBraintree.[name]/external [\"wp\",\"apiFetch\"]","webpack://wcBraintree.[name]/webpack/bootstrap","webpack://wcBraintree.[name]/./packages/woofunnels/assets/js/index.js"],"names":["module","exports","obj","key","value","Object","defineProperty","enumerable","configurable","writable","__esModule","window","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","threeDSecureInstance","params","getData","defaultValue","setData","initEvents","document","on","onHandleSubmit","e","bucket","getTotal","vaultedNonce","inOfferTransaction","args","amount","formatPrice","nonce","bin","details","onLookupComplete","data","next","verifyCard","then","payload","liabilityShifted","liabilityShiftPossible","wfocuCommons","addFilter","_wc_braintree_woofunnels_3ds_nonce","deviceData","sendBucket","swal","hide","resetPaymentProcess","fetchVaultedNonce","catch","error","console","log","originalError","message","displayNotice","addClientError","_client_error","EnableButtonState","HasEventRunning","type","show","text","setTimeout","path","method","token","response","wfocu_vars","wcBraintree","threeDSecure","create","authorization","version","instance","setThreeDSecureInstance","dataCollector","kount"],"mappings":"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","file":"wc-braintree-woofunnels.js","sourcesContent":["function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","function _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nmodule.exports = _interopRequireDefault;","module.exports = window[\"jQuery\"];","module.exports = window[\"braintree\"][\"dataCollector\"];","module.exports = window[\"braintree\"][\"threeDSecure\"];","module.exports = window[\"wp\"][\"apiFetch\"];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import threeDSecure from '@braintree/three-d-secure';\r\nimport dataCollector from '@braintree/data-collector';\r\nimport $ from 'jquery';\r\nimport apiFetch from '@wordpress/api-fetch';\r\n\r\nlet threeDSecureInstance = null;\r\n\r\nlet params = null;\r\n\r\nconst loadDataCollector = () => {\r\n    dataCollector.create({\r\n        authorization: getData('clientToken'),\r\n        kount: true,\r\n    }).then(instance => setData('dataCollector', instance)).catch(error => {\r\n        console.log(error);\r\n    });\r\n}\r\n\r\nconst getData = (key, defaultValue = '') => {\r\n    return params?.[key] || defaultValue;\r\n}\r\n\r\nconst setData = (key, value) => {\r\n    params[key] = value;\r\n}\r\n\r\nconst setThreeDSecureInstance = (instance) => {\r\n    threeDSecureInstance = instance;\r\n}\r\n\r\nconst loadThreeDSecure = () => {\r\n    threeDSecure.create({\r\n        authorization: getData('clientToken'),\r\n        version: 2\r\n    }).then(instance => {\r\n        setThreeDSecureInstance(instance)\r\n        initEvents();\r\n    }).catch(error => {\r\n        console.log(error);\r\n        addClientError(error);\r\n    })\r\n}\r\n\r\nconst initialize = () => {\r\n    $(document).on('wfocuBucketCreated', onBucketCreated);\r\n}\r\n\r\nconst initEvents = () => {\r\n    $(document).on('wfocu_external', onHandleSubmit);\r\n}\r\n\r\nconst onBucketCreated = (e, bucket) => {\r\n    params = window?.wfocu_vars?.wcBraintree;\r\n    params.bucket = bucket;\r\n    loadThreeDSecure();\r\n    loadDataCollector();\r\n}\r\n\r\nconst onHandleSubmit = (e, bucket) => {\r\n    if (0 < bucket.getTotal() && !getData('threeDSecureComplete', false)) {\r\n        const vaultedNonce = getData('vaultedNonce');\r\n        bucket.inOfferTransaction = true;\r\n        const args = {\r\n            amount: bucket.formatPrice(bucket.getTotal(), 2, \"\", \".\"),\r\n            nonce: vaultedNonce?.nonce,\r\n            bin: vaultedNonce?.details.bin,\r\n            onLookupComplete: (data, next) => {\r\n                next()\r\n            },\r\n            ...getData('threeDSecureData')\r\n        }\r\n        threeDSecureInstance.verifyCard(args).then(payload => {\r\n            if ((!payload.liabilityShifted && !payload.liabilityShiftPossible) || payload.liabilityShifted) {\r\n                wfocuCommons.addFilter('wfocu_front_charge_data', (e) => {\r\n                    e._wc_braintree_woofunnels_3ds_nonce = payload.nonce;\r\n                    if (getData('dataCollector')) {\r\n                        e[`${getData('paymentMethod')}_device_data`] = getData('dataCollector')?.deviceData\r\n                    }\r\n                    setData('threeDSecureComplete', true);\r\n                    return e;\r\n                });\r\n                bucket.sendBucket();\r\n            } else {\r\n                getData('bucket')?.swal?.hide();\r\n                resetPaymentProcess();\r\n                fetchVaultedNonce();\r\n            }\r\n        }).catch(error => {\r\n            console.log(error);\r\n            if (error?.details?.originalError?.details?.originalError?.error?.message) {\r\n                const message = error.details.originalError.details.originalError.error.message;\r\n                displayNotice(message, 'warning');\r\n            }\r\n            addClientError(error);\r\n        });\r\n    } else {\r\n        resetPaymentProcess();\r\n    }\r\n}\r\n\r\nconst addClientError = (error) => {\r\n    wfocuCommons.addFilter('wfocu_front_charge_data', (e) => {\r\n        e._client_error = error?.message;\r\n        return e;\r\n    });\r\n    resetPaymentProcess();\r\n}\r\n\r\nconst resetPaymentProcess = () => {\r\n    getData('bucket').inOfferTransaction = false;\r\n    getData('bucket').EnableButtonState();\r\n    getData('bucket').HasEventRunning = false;\r\n}\r\nconst displayNotice = (message, type) => {\r\n    getData('bucket')?.swal?.show({text: message, type});\r\n    setTimeout(() => {\r\n        getData('bucket')?.swal?.hide();\r\n    }, 3000);\r\n}\r\n\r\nconst fetchVaultedNonce = () => {\r\n    apiFetch({\r\n        path: '/wc-braintree/v1/3ds/vaulted_nonce',\r\n        method: 'POST',\r\n        data: {token: getData('paymentMethodToken')}\r\n    }).then(response => {\r\n        setData('vaultedNonce', response.data);\r\n    }).catch(error => console.log(error));\r\n}\r\n\r\ninitialize();"],"sourceRoot":""}